!function(t,e){"use strict";var a={$global:{}},s={},l={},i=!1,n=!1,o={entities:[]},c={module:function(e,t,n){if(i)throw"Cannot add/overwrite modules when the game system is running!";s[e]={name:e,dependencies:t,body:n,loaded:!1},u(s[e])},addToEnvironment:function(e,t){if(a[e])throw"The object name "+e+" is already in use! Please make sure you're not overwriting an already imported module.";a[e]="object"==typeof t?Object.assign(Object.create(a),t):t},game:function(){return a},Point:function(e,t){this.x=parseInt(e)||0,this.y=parseInt(t)||0},run:function(e){"complete"===t.document.readyState?r(e):t.addEventListener("load",r.bind(this,e),!1)},log:function(){this.verbose&&console.log.apply(null,arguments)},VERSION:5,verbose:!1};function u(e,t){if(0===e.dependencies.length)p(e);else{for(var n=!0,i=0;i<e.dependencies.length;i++){var r=s[e.dependencies[i]],o=!1;r&&r.loaded&&(o=!0),o||(c.log("Sylx: Dependency not loaded yet, adding "+e.name+" to queue"),l[e.dependencies[i]]=l[e.dependencies[i]]||[],l[e.dependencies[i]].push(e.name),n=!1)}n&&(p(e),t&&l[t].splice(l[t].indexOf(e.name),1))}}function p(e){var t=0,n={};c.log("Sylx: Initializing module "+e.name),"function"==typeof e.body&&(e.body=e.body.call(a)||{}),n=Object.getPrototypeOf(e.body)===Object.prototype?Object.assign(Object.create(a),e.body):e.body;var i=e.name.split("."),r=a;for(t=0;t<i.length;t++){var o=i[t];parseInt(t)===i.length-1?r[o]=n:(r[o]=r[o]||{},r=r[o])}if("function"==typeof n.onload&&n.onload(),e.loaded=!0,l[e.name])for(t=l[e.name].length-1;0<=t;t--)u(s[l[e.name][t]],e.name)}function r(e){0<l.length&&console.warn("There is unresolved dependencies! Your game might not have loaded properly.",l),"function"==typeof e&&e.call(a),i=!0,c.log("Sylx: Game is now running!"),t.requestAnimationFrame(function e(){t.stats&&t.stats.begin();n||function(){if(c.Input._update(),o&&("function"==typeof o.update&&o.update(a),!o.frozenEntities))for(var e=0,t=o.entities.length;e<t;e++){var n=o.entities[e];if(!n._kill&&("function"==typeof n.update&&n.update.call(n,a),n.movement&&c.Component.System.movement(n),n.animator&&c.Component.System.animator(n),n.collision&&(n.collision.collidesWith=[]),e<t))for(var i=e+1;i<t;i++){var r=o.entities[i];n.collision&&r.collision&&c.Component.System.collision(n,r)}}}();n?function(){var e=c.Canvas.getContext("buffer");c.Canvas.autoClear&&c.Canvas.clearCanvas("buffer");var t=c.Asset.getProgress(),n=255*t;e.globalAlpha=.5,e.lineWidth=1,e.fillStyle="rgb("+Math.floor(255-n)+", "+Math.floor(n)+", 128)",e.fillRect(0,c.Canvas.height-2,c.Canvas.width*t,2),c.Canvas.autoCopy&&c.Canvas.copy()}():function(){var e=c.Canvas.getContext("buffer");e.globalAlpha=1,c.Canvas.autoClear&&c.Canvas.clearCanvas("buffer");if(o){if("function"==typeof o.renderBefore&&o.renderBefore(e),o.maps)for(var t=0;t<o.maps.length;t++)c.Map._render(o.maps[t],e);for(var n=0,i=o.entities.length;n<i;n++){var r=o.entities[n];r._kill||r.sprite&&c.Component.System.sprite(r,e)}"function"==typeof o.renderAfter&&o.renderAfter(e)}"number"==typeof o.opacity?c.Canvas.getContext("main").globalAlpha=o.opacity:c.Canvas.getContext("main").globalAlpha=1;c.Canvas.autoCopy&&c.Canvas.copy()}();c.Entity._cleanupKilledEntities(o.entities);c.Scene._scheduledSceneToSet&&(o&&"function"==typeof o.exit&&o.exit(a),"function"==typeof(o=c.Scene._scheduledSceneToSet).preload&&o.preload.apply(o,c.Scene._argumentsForScene),c.Asset._isPreloading?n=!0:f(),c.Scene._scheduledSceneToSet=null);n&&!1===c.Asset._isPreloading&&(n=!1,f());0;t.stats&&t.stats.end();i&&t.requestAnimationFrame(e.bind(a))}.bind(a))}function f(){"function"==typeof o.init&&o.init.apply(o,c.Scene._argumentsForScene),c.log("Sylx: Setting scene",o.name||"")}t.Sylx?t.Sylx=Object.assign(t.Sylx,c):t.Sylx=c}(window),window.Sylx.Asset=function(o,e,t){"use strict";var i=[],n=[],r=0,a={};function s(e,t){a[e]=t,n.splice(n.indexOf(e),1),0===n.length&&function(){for(var e=0;e<i.length;e++){var t=i[e],n=t.path;if(a[n]){t.data=a[n],t.type=c(n),t.loaded=!0,i.splice(e,1);break}}u._isPreloading=!1}()}function l(e){return a[e]?(n.splice(n.indexOf(e),1),a[e]):function(n,e){e=e||!0;var t=c(n);if("image"===t){var i=new o.Image;return i.src=n,e?i.onload=s.bind(null,n,i):a[n]=i,i}if("json"===t){var r=new XMLHttpRequest;r.open("GET",n,!0),r.responseType="json",r.onload=function(){var e=r.status,t=r.response;if(200!==e)throw t;s(n,t)},r.send()}}(e,!0)}function c(e){var t=e.split(".");switch(1===t.length||""===t[0]&&2===t.length?"":t.pop().toLowerCase()){case"png":case"gif":case"jpg":return"image";case"json":return"json"}}var u={create:function(e,t){var n=Object.assign({path:e,loaded:!1,data:null},t||{});return a[e]?(n.data=a[e],n.type=c(e),n.loaded=!0):i.push(n),n},getFromCache:function(e){return a[e]?a[e]:null},queue:function(){if(0===arguments.length)return null;for(var e=0;e<arguments.length;e++){var t=arguments[e];"string"==typeof t?n.push({path:t}):"object"==typeof t&&(Array.isArray(t)?this.queue.apply(this,t):n.push(t))}},preloadQueue:function(){if(0===n.length)return null;r=n.length,this._isPreloading=!0;for(var e=0;e<n.length;e++)l(n[e].path)},getProgress:function(){return this._isPreloading?1-n.length/r:1},clearCache:function(){a={}},_isPreloading:!1};return u}(window,window.Sylx),window.Sylx.Canvas=function(r,e,t){"use strict";var n,i,o,a={},s={create:function(e){if(a.main)return console.warn("$display.create should only be called once."),null;n=e.width||320,i=e.height||240,o=e.scale||1,a.main=function(e){if(1<e.scale){var t=e.width*e.scale,n=e.height*e.scale;e.element.style.width=t+"px",e.element.style.height=n+"px",e.element.style.imageRendering="-moz-crisp-edges",e.element.style.imageRendering="-webkit-crisp-edges",e.element.style.imageRendering="pixelated",e.element.style.imageRendering="crisp-edges",e.element.style.msInterpolationMode="nearest-neighbor"}return e}(this._createCanvas(n,i,o)),a.buffer=this._createCanvas(n,i,1),function(e,t){var n;if("string"==typeof e){if(void 0===(n=r.document.getElementById(e)))return r.console.error('Element "'+e+'" was not found!')}else"object"==typeof e&&"function"==typeof e.appendChild&&e.nodeType&&(n=e);n.appendChild(t)}(e.appendTo||document.body,a.main.element),this.width=n,this.height=i,this.scale=o},getContext:function(e){return a[e]?a[e].context:null},clearCanvas:function(e){if(!a[e])return null;var t=a[e];t.context.fillStyle=this.fillColor,t.context.fillRect(0,0,t.width,t.height)},copy:function(){a.main.context.clearRect(0,0,n,i),a.main.context.drawImage(a.buffer.element,0,0)},_createCanvas:function(e,t,n){var i={element:r.document.createElement("canvas"),width:e,height:t,scale:n};return i.context=i.element.getContext("2d"),i.element.width=e,i.element.height=t,i.context.fillStyle=s.fillColor,i.context.imageSmoothingEnabled=!1,i.context.mozImageSmoothingEnabled=!1,i.context.oImageSmoothingEnabled=!1,i.context.webkitImageSmoothingEnabled=!1,i.context.msImageSmoothingEnabled=!1,i},autoClear:!0,autoCopy:!0,fillColor:"#000000",width:null,height:null,scale:null,offset:{x:0,y:0}};return s}(window,window.Sylx),window.Sylx.Component=function(e,l,t){"use strict";var n={sprite:function(e){return e||(e={}),this.position=e.position||new l.Point,this.size=e.size||new l.Point(16,16),this.offset=e.offset||new l.Point,this.sourcePosition=e.sourcePosition||new l.Point,this.image=e.image||null,this.visible=e.visible||!0,this.opacity=e.opacity||1,this.order=e.order||0,this},movement:function(e){return e||(e={}),this.speed=e.speed||new l.Point,this.acceleration=e.acceleration||new l.Point,this.duration=0,this},collision:function(){return this.collidesWith=[],this},animator:function(e){return this.collection=e.collection||{},this.current=e.current||null,this.next=null,this.step=0,this.timeleft=0,this.frame=0,this.flip={x:!1,y:!1},this}};return{getConstructor:function(e){return e?n[e]:n},createComponent:function(e,t){if(n[e])throw"Component constructor "+e+" already exists!";n[e]=t},Constructor:n,System:{sprite:function(e,t){var n=e.sprite;if(!n.visible)return null;var i=n.image.data;if(i&&i.complete){var r=l.Scene.getCurrent().scroll,o=n.position.x-n.offset.x-r.x,a=n.position.y-n.offset.y-r.y;if(o>l.Canvas.width||a>l.Canvas.height||o<-n.size.x||a<-n.size.y)return null;"number"==typeof n.opacity?t.globalAlpha=n.opacity:t.globalAlpha=1;var s={x:1,y:1};n.flip&&(n.flip.x&&(s.x=-1),n.flip.y&&(s.y=-1)),-1!==s.x&&-1!==s.y||t.scale(s.x,s.y),t.drawImage(i,n.sourcePosition.x,n.sourcePosition.y,n.size.x,n.size.y,o*s.x-(-1===s.x?n.size.x:0),a*s.y-(-1===s.y?n.size.y:0),n.size.x,n.size.y),-1!==s.x&&-1!==s.y||t.scale(s.x,s.y)}},movement:function(e){if(!e.sprite)return null;var t=e.sprite,n=e.movement;t.position.x+=n.speed.x,t.position.y+=n.speed.y,n.speed.x+=n.acceleration.x,n.speed.y+=n.acceleration.y,n.duration&&(n.duration--,0===n.duration&&(n.speed.x=0,n.speed.y=0,n.acceleration.x=0,n.acceleration.y=0))},collision:function(e,t){var n=e.sprite,i=t.sprite;n.position.x<i.position.x+i.size.x&&n.position.x+n.size.x>i.position.x&&n.position.y<i.position.y+i.size.y&&n.size.y+n.position.y>i.position.y&&(e.collision.collidesWith.push(t),t.collision.collidesWith.push(e))},animator:function(e){if(!e.sprite)return null;var t=e.animator;e.sprite;if(t.next&&(t.current=t.next,t.step=0,t.timeleft=t.collection[t.current].duration,t.frame=t.collection[t.current].cycle[0],t.flip.x=t.collection[t.current].flipX||!1,t.flip.y=t.collection[t.current].flipY||!1,t.next=null,this.spritesheet(e)),!t.current)return null;var n=t.collection[t.current];if(t.timeleft<0)return null;t.timeleft--,t.timeleft<=0&&(t.step++,t.step===n.cycle.length&&(t.step=0),t.timeleft=n.duration,t.frame=n.cycle[t.step],this.spritesheet(e))},spritesheet:function(e){if(e.spritesheet){var t=e.spritesheet[e.animator.frame];e.sprite.sourcePosition=t.position,e.sprite.size=t.size||e.sprite.size,e.sprite.offset=t.offset||e.sprite.offset}else e.sprite.sourcePosition.x=e.animator.frame*e.sprite.size.x,e.sprite.sourcePosition.y=0;e.sprite.flip=e.animator.flip}}}}(window,window.Sylx),window.Sylx.Entity=function(e,i,t){"use strict";var r={},o=[],a=function(){return this._kill=!1,this},s={constructor:null,environment:null,init:function(){},update:function(){},create:function(){var e=this.constructor||a,t=e.apply(Object.create(e.prototype),arguments),n=Object.assign(Object.create(this),t);return n.init.apply(n,arguments),n},addComponent:function(e,t,n){return"function"==typeof t?this[e]=new t(n):"object"==typeof t&&(this[e]=t),this},isInstanceOf:function(e){return"string"==typeof e?r[e].isPrototypeOf(this):e.isPrototypeOf(this)},kill:function(){return this._kill||(this._kill=!0,o.push(this)),this}};return{define:function(e,t){null===s.environment&&(s.environment=i.game()),t&&(e.$parent=t);var n=Object.assign(Object.create(t||s),e);return i.log("Sylx.Entity: Defined new entity",n.name),n},defineAs:function(e,t,n){var i=this.define(t,n);return r[e]=i},create:function(e,t){if("object"==typeof e)return s.create.apply(e,t);if("string"==typeof e){if(r[e])return s.create.apply(r[e],t);throw"Entity definition '"+e+"' does not exist!"}return null},getDefinitionFromName:function(e){return r[e]},_cleanupKilledEntities:function(e){if(0!==o.length){for(var t=0,n=o.length;t<n;t++){var i=e.indexOf(o[t]);"function"==typeof o[t].exit&&o[t].exit(),e.splice(i,1)}return o=[],e}}}}(window,window.Sylx),window.Sylx.Input=function(n,e,t){"use strict";var i={},r=!1,o={down:{},pressed:{},last:{}};return{bind:function(e){for(var t in e)i[e[t]]=t;r||(n.document.addEventListener("keydown",function(e){i[e.keyCode]&&(o.down[i[e.keyCode]]=!0)}),n.document.addEventListener("keyup",function(e){i[e.keyCode]&&(o.down[i[e.keyCode]]=!1)}),r=!0)},pressed:function(e){return o.pressed[e]},down:function(e){return o.down[e]},_update:function(){for(var e in o.down)o.pressed[e]=!o.last[e]&&o.down[e],o.last[e]=o.down[e]}}}(window,window.Sylx),window.Sylx.Map=function(e,a,t){"use strict";var i=Object.assign(Object.create(a.game()),{getTileAt:function(e,t){return e<0||t<0||e>=this.size.x||t>=this.size.y?0:this.data[t][e]},setTile:function(e,t,n,i){if(t<0||n<0||t>=this.size.x||n>=this.size.y)return null;if(this.data[n][t]=e,!i){if(!this.prerender)return void console.warn("Tried to draw to map while prerender is not ready!");var r=(t-this.prerender.topLeft.x)*this.prerender.tileSize.x,o=(n-this.prerender.topLeft.y)*this.prerender.tileSize.y;0<=r&&0<=o&&r<this.prerender.canvas.width&&o<this.prerender.canvas.height&&l(this,e,r,o)}}});function s(e){e.data,e.tileset;for(var t=e.prerender,n=0;n<t.tilesPerRow;n++)for(var i=0;i<t.tilesPerCol;i++)l(e,e.getTileAt(n+t.topLeft.x,i+t.topLeft.y),n*t.tileSize.x,i*t.tileSize.y)}function l(e,t,n,i){e.tileset.data.complete&&e.prerender.canvas.context.drawImage(e.tileset.data,t*e.tileSize.x,0,e.tileSize.x,e.tileSize.y,n,i,e.tileSize.x,e.tileSize.y)}return{create:function(e){var t=Object.assign(Object.create(i),e);if(t.prerender=null,t.size&&!t.data){t.data=new Array(t.size.y);for(var n=0;n<t.size.y;n++)t.data[n]=new Array(t.size.x).fill(0)}return a.log("Sylx.Map: Created new map",e.name),t},_render:function(e,t){if(!e.tileset||!e.tileSize)return null;var n=e.scroll||a.Scene.getCurrent().scroll,i=Math.floor(n.x/e.tileSize.x),r=Math.floor(n.y/e.tileSize.y);e.prerender||(!function(e){var t={};t.tilesPerRow=Math.ceil(a.Canvas.width/e.tileSize.x)+1,t.tilesPerCol=Math.ceil(a.Canvas.height/e.tileSize.y)+1,t.tileSize=e.tileSize;var n=t.tilesPerRow*e.tileSize.x,i=t.tilesPerCol*e.tileSize.y;t.canvas=a.Canvas._createCanvas(n,i,1),t.topLeft=new a.Point(0,0),e.prerender=t}(e),e.prerender.topLeft.x=i,e.prerender.topLeft.y=r,s(e));var o=new a.Point(i-e.prerender.topLeft.x,r-e.prerender.topLeft.y);(o.x||o.y)&&(e.prerender.topLeft.x=i,e.prerender.topLeft.y=r,s(e)),"number"==typeof e.opacity?t.globalAlpha=e.opacity:t.globalAlpha=1,t.drawImage(e.prerender.canvas.element,n.x%e.tileSize.x,n.y%e.tileSize.y,a.Canvas.width,a.Canvas.height,0,0,a.Canvas.width,a.Canvas.height)}}}(window,window.Sylx),window.Sylx.Scene=function(e,a,t){"use strict";var n,i={},r=Object.assign(Object.create(a.game()),{addEntity:function(e){return this.entities.push(e),e},createEntity:function(e){if("string"==typeof e&&(e=a.Entity.getDefinitionFromName(e)),"function"!=typeof e.create)throw"The provided definition does not have a create method!";var t=Array.prototype.slice.call(arguments).slice(1),n=e.create.apply(e,t);return this.entities.push(n),n},getEntitiesByType:function(e){if(0===this.entities.length)return[];var t,n=[];"object"==typeof e?t=e:"string"==typeof e&&(t=a.Entity.getDefinitionFromName(e));for(var i=0,r=this.entities.length;i<r;i++){var o=this.entities[i];o._kill||t.isPrototypeOf(o)&&n.push(o)}return n},setLevel:function(e){var t,n;for(this.maps=new Array(e.map.length),t=0,n=e.map.length;t<n;t++)this.maps[t]=a.Map.create(e.map[t]);for(t=0,n=e.entities.length;t<n;t++)this.createEntity.apply(this,e.entities[t])},getMap:function(e){if(this.maps)return this.maps[e]},addMap:function(e){this.maps||(this.maps=[]),this.maps.push(e)},removeMap:function(e){if(!this.maps)return null;"object"==typeof e&&(e=this.maps.indexOf(e)),0<=e&&e<this.maps.length&&this.maps.splice(e,1)}});return{create:function(e){var t=Object.assign(Object.create(r),e);return t.maps=[],t.entities=[],t.scroll=t.scroll||new a.Point,a.log("Sylx.Scene: Created new scene",e.name),t},createAs:function(e,t){return i[e]=this.create(t),i[e]},getCurrent:function(){return n},set:function(e){var t;if("object"==typeof e)t=e;else if("string"==typeof e){if(!i[name])throw"Scene '"+e+"' has not been created!";t=i[e]}if(!e)throw"Scene is empty!";return this._scheduledSceneToSet=t,this._argumentsForScene=Array.prototype.slice.call(arguments).slice(1),n=t},frozenEntities:!1,_scheduledSceneToSet:null,_argumentsForScene:[]}}(window,window.Sylx),window.Sylx.Text=function(r,e,t){"use strict";var c={},u=null;return{registerFont:function(e,t,n){var i=n?Object.assign({},n):{};if(!i.firstCharCode)throw"Missing property: firstCharCode";if(!i.characterWidth)throw"Missing property: characterWidth";if("string"==typeof t)i.bitmap=new r.Image,i.bitmap.src=t;else{if("object"!=typeof t)throw"Unknown bitmap format provided.";t.data&&(i.bitmap=t.data)}n.setAsDefault&&(u=e),c[e]=i},renderText:function(e,t,n,i,r){r=r||{};var o="string"==typeof e?e:e.toString();r.noTrim||(o=o.trim());for(var a=r.font?c[r.font]:c[u],s=0;s<o.length;s++){var l=o.charCodeAt(s);l>=a.firstCharCode&&l<=a.lastCharCode&&i.drawImage(a.bitmap,(l-a.firstCharCode)*a.characterWidth,0,a.characterWidth,a.characterHeight,t+s*a.characterWidth,n,a.characterWidth,a.characterHeight)}},createPrerenderImage:function(){}}}(window,window.Sylx);