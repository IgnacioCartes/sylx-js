!function(t,e){"use strict";var s={$global:{}},a={},l={},i=!1,n=!1,r={entities:[]},c={module:function(e,t,n){if(i)throw"Cannot add/overwrite modules when the game system is running!";a[e]={name:e,dependencies:t,body:n,loaded:!1},u(a[e])},addToEnvironment:function(e,t){if(s[e])throw"The object name "+e+" is already in use! Please make sure you're not overwriting an already imported module.";s[e]="object"==typeof t?Object.assign(Object.create(s),t):t},game:function(){return s},Point:function(e,t){this.x=parseInt(e)||0,this.y=parseInt(t)||0},run:function(e){"complete"===t.document.readyState?o(e):t.addEventListener("load",o.bind(this,e),!1)},log:function(){this.verbose&&console.log.apply(null,arguments)},VERSION:5,verbose:!1};function u(e,t){if(0===e.dependencies.length)f(e);else{for(var n=!0,i=0;i<e.dependencies.length;i++){var o=a[e.dependencies[i]],r=!1;o&&o.loaded&&(r=!0),r||(c.log("Sylx: Dependency not loaded yet, adding "+e.name+" to queue"),l[e.dependencies[i]]=l[e.dependencies[i]]||[],l[e.dependencies[i]].push(e.name),n=!1)}n&&(f(e),t&&l[t].splice(l[t].indexOf(e.name),1))}}function f(e){var t=0,n={};c.log("Sylx: Initializing module "+e.name),"function"==typeof e.body&&(e.body=e.body.call(s)||{}),n=Object.getPrototypeOf(e.body)===Object.prototype?Object.assign(Object.create(s),e.body):e.body;var i=e.name.split("."),o=s;for(t=0;t<i.length;t++){var r=i[t];parseInt(t)===i.length-1?o[r]=n:(o[r]=o[r]||{},o=o[r])}if("function"==typeof n.onload&&n.onload(),e.loaded=!0,l[e.name])for(t=l[e.name].length-1;0<=t;t--)u(a[l[e.name][t]],e.name)}function o(e){0<l.length&&console.warn("There is unresolved dependencies! Your game might not have loaded properly.",l),"function"==typeof e&&e.call(s),i=!0,c.log("Sylx: Game is now running!"),t.requestAnimationFrame(function e(){t.stats&&t.stats.begin();n||function(){if(c.Input._update(),r&&("function"==typeof r.update&&r.update(s),!r.frozenEntities))for(var e=0,t=r.entities.length;e<t;e++){var n=r.entities[e];if(!n._kill&&("function"==typeof n.update&&n.update.call(n,s),n.movement&&c.Component.System.movement(n),n.animator&&c.Component.System.animator(n),n.collision&&(n.collision.collidesWith=[]),e<t))for(var i=e+1;i<t;i++){var o=r.entities[i];n.collision&&o.collision&&c.Component.System.collision(n,o)}}}();n?function(){var e=c.Canvas.getContext("buffer");c.Canvas.autoClear&&c.Canvas.clearCanvas("buffer");var t=c.Asset.getProgress(),n=255*t;e.globalAlpha=.5,e.lineWidth=1,e.fillStyle="rgb("+Math.floor(255-n)+", "+Math.floor(n)+", 128)",e.fillRect(0,c.Canvas.height-2,c.Canvas.width*t,2),c.Canvas.autoCopy&&c.Canvas.copy()}():function(){var e=c.Canvas.getContext("buffer");e.globalAlpha=1,c.Canvas.autoClear&&c.Canvas.clearCanvas("buffer");if(r){if("function"==typeof r.renderBefore&&r.renderBefore(e),r.maps)for(var t=0;t<r.maps.length;t++)c.Map._render(r.maps[t],e);for(var n=0,i=r.entities.length;n<i;n++){var o=r.entities[n];o._kill||o.sprite&&c.Component.System.sprite(o,e)}"function"==typeof r.renderAfter&&r.renderAfter(e)}c.Canvas.autoCopy&&c.Canvas.copy()}();c.Entity._cleanupKilledEntities(r.entities);c.Scene._scheduledSceneToSet&&(r&&"function"==typeof r.exit&&r.exit(s),"function"==typeof(r=c.Scene._scheduledSceneToSet).preload&&r.preload.apply(r,c.Scene._argumentsForScene),c.Asset._isPreloading?n=!0:p(),c.Scene._scheduledSceneToSet=null);n&&!1===c.Asset._isPreloading&&(n=!1,p());0;t.stats&&t.stats.end();i&&t.requestAnimationFrame(e.bind(s))}.bind(s))}function p(){"function"==typeof r.init&&r.init.apply(r,c.Scene._argumentsForScene),c.log("Sylx: Setting scene",r.name||"")}t.Sylx?t.Sylx=Object.assign(t.Sylx,c):t.Sylx=c}(window),window.Sylx.Asset=function(r,e,t){"use strict";var i=[],n=[],o=0,s={};function a(e,t){s[e]=t,n.splice(n.indexOf(e),1),0===n.length&&function(){for(var e=0;e<i.length;e++){var t=i[e],n=t.path;if(s[n]){t.data=s[n],t.type=c(n),t.loaded=!0,i.splice(e,1);break}}u._isPreloading=!1}()}function l(e){return s[e]?(n.splice(n.indexOf(e),1),s[e]):function(n,e){e=e||!0;var t=c(n);if("image"===t){var i=new r.Image;return i.src=n,e?i.onload=a.bind(null,n,i):s[n]=i,i}if("json"===t){var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="json",o.onload=function(){var e=o.status,t=o.response;if(200!==e)throw t;a(n,t)},o.send()}}(e,!0)}function c(e){var t=e.split(".");switch(1===t.length||""===t[0]&&2===t.length?"":t.pop().toLowerCase()){case"png":case"gif":case"jpg":return"image";case"json":return"json"}}var u={create:function(e,t){var n=Object.assign({path:e,loaded:!1,data:null},t||{});return s[e]?(n.data=s[e],n.type=c(e),n.loaded=!0):i.push(n),n},getFromCache:function(e){return s[e]?s[e]:null},queue:function(){if(0===arguments.length)return null;for(var e=0;e<arguments.length;e++){var t=arguments[e];"string"==typeof t?n.push({path:t}):"object"==typeof t&&(Array.isArray(t)?this.queue.apply(this,t):n.push(t))}},preloadQueue:function(){if(0===n.length)return null;o=n.length,this._isPreloading=!0;for(var e=0;e<n.length;e++)l(n[e].path)},getProgress:function(){return this._isPreloading?1-n.length/o:1},clearCache:function(){s={}},_isPreloading:!1};return u}(window,window.Sylx),window.Sylx.Canvas=function(o,e,t){"use strict";var n,i,r,s={},a={create:function(e){if(s.main)return console.warn("$display.create should only be called once."),null;n=e.width||320,i=e.height||240,r=e.scale||1,s.main=function(e){if(1<e.scale){var t=e.width*e.scale,n=e.height*e.scale;e.element.style.width=t+"px",e.element.style.height=n+"px",e.element.style.imageRendering="-moz-crisp-edges",e.element.style.imageRendering="-webkit-crisp-edges",e.element.style.imageRendering="pixelated",e.element.style.imageRendering="crisp-edges",e.element.style.msInterpolationMode="nearest-neighbor"}return e}(this._createCanvas(n,i,r)),s.buffer=this._createCanvas(n,i,1),function(e,t){var n;if("string"==typeof e){if(void 0===(n=o.document.getElementById(e)))return o.console.error('Element "'+e+'" was not found!')}else"object"==typeof e&&"function"==typeof e.appendChild&&e.nodeType&&(n=e);n.appendChild(t)}(e.appendTo||document.body,s.main.element),this.width=n,this.height=i,this.scale=r},getContext:function(e){return s[e]?s[e].context:null},clearCanvas:function(e){if(!s[e])return null;var t=s[e];t.context.fillStyle=this.fillColor,t.context.fillRect(0,0,t.width,t.height)},copy:function(){s.main.context.clearRect(0,0,n,i),s.main.context.drawImage(s.buffer.element,0,0)},_createCanvas:function(e,t,n){var i={element:o.document.createElement("canvas"),width:e,height:t,scale:n};return i.context=i.element.getContext("2d"),i.element.width=e,i.element.height=t,i.context.fillStyle=a.fillColor,i.context.imageSmoothingEnabled=!1,i.context.mozImageSmoothingEnabled=!1,i.context.oImageSmoothingEnabled=!1,i.context.webkitImageSmoothingEnabled=!1,i.context.msImageSmoothingEnabled=!1,i},autoClear:!0,autoCopy:!0,fillColor:"#000000",width:null,height:null,scale:null,offset:{x:0,y:0}};return a}(window,window.Sylx),window.Sylx.Component=function(e,l,t){"use strict";var n={sprite:function(e){return e||(e={}),this.position=e.position||new l.Point,this.size=e.size||new l.Point(16,16),this.offset=e.offset||new l.Point,this.sourcePosition=e.sourcePosition||new l.Point,this.image=e.image||null,this.visible=e.visible||!0,this.opacity=e.opacity||1,this.order=e.order||0,this},movement:function(e){return e||(e={}),this.speed=e.speed||new l.Point,this.acceleration=e.acceleration||new l.Point,this.duration=0,this},collision:function(){return this.collidesWith=[],this},animator:function(e){return this.collection=e.collection||{},this.current=e.current||null,this.next=null,this.step=0,this.timeleft=0,this.frame=0,this.flip={x:!1,y:!1},this}};return{getConstructor:function(e){return e?n[e]:n},createComponent:function(e,t){if(n[e])throw"Component constructor "+e+" already exists!";n[e]=t},Constructor:n,System:{sprite:function(e,t){var n=e.sprite;if(!n.visible)return null;var i=n.image.data;if(i&&i.complete){var o=l.Scene.getCurrent().scroll,r=n.position.x-n.offset.x-o.x,s=n.position.y-n.offset.y-o.y;if(r>l.Canvas.width||s>l.Canvas.height||r<-n.size.x||s<-n.size.y)return null;"number"==typeof n.opacity?t.globalAlpha=n.opacity:t.globalAlpha=1;var a={x:1,y:1};n.flip&&(n.flip.x&&(a.x=-1),n.flip.y&&(a.y=-1)),-1!==a.x&&-1!==a.y||t.scale(a.x,a.y),t.drawImage(i,n.sourcePosition.x,n.sourcePosition.y,n.size.x,n.size.y,r*a.x-(-1===a.x?n.size.x:0),s*a.y-(-1===a.y?n.size.y:0),n.size.x,n.size.y),-1!==a.x&&-1!==a.y||t.scale(a.x,a.y)}},movement:function(e){if(!e.sprite)return null;var t=e.sprite,n=e.movement;t.position.x+=n.speed.x,t.position.y+=n.speed.y,n.speed.x+=n.acceleration.x,n.speed.y+=n.acceleration.y,n.duration&&(n.duration--,0===n.duration&&(n.speed.x=0,n.speed.y=0,n.acceleration.x=0,n.acceleration.y=0))},collision:function(e,t){var n=e.sprite,i=t.sprite;n.position.x<i.position.x+i.size.x&&n.position.x+n.size.x>i.position.x&&n.position.y<i.position.y+i.size.y&&n.size.y+n.position.y>i.position.y&&(e.collision.collidesWith.push(t),t.collision.collidesWith.push(e))},animator:function(e){if(!e.sprite)return null;var t=e.animator;e.sprite;if(t.next&&(t.current=t.next,t.step=0,t.timeleft=t.collection[t.current].duration,t.frame=t.collection[t.current].cycle[0],t.flip.x=t.collection[t.current].flipX||!1,t.flip.y=t.collection[t.current].flipY||!1,t.next=null,this.spritesheet(e)),!t.current)return null;var n=t.collection[t.current];if(t.timeleft<0)return null;t.timeleft--,t.timeleft<=0&&(t.step++,t.step===n.cycle.length&&(t.step=0),t.timeleft=n.duration,t.frame=n.cycle[t.step],this.spritesheet(e))},spritesheet:function(e){if(e.spritesheet){var t=e.spritesheet[e.animator.frame];e.sprite.sourcePosition=t.position,e.sprite.size=t.size||e.sprite.size,e.sprite.offset=t.offset||e.sprite.offset}else e.sprite.sourcePosition.x=e.animator.frame*e.sprite.size.x,e.sprite.sourcePosition.y=0;e.sprite.flip=e.animator.flip}}}}(window,window.Sylx),window.Sylx.Entity=function(e,i,t){"use strict";var o={},r=[],s=function(){return this._kill=!1,this},a={constructor:null,environment:null,init:function(){},update:function(){},create:function(){var e=this.constructor||s,t=e.apply(Object.create(e.prototype),arguments),n=Object.assign(Object.create(this),t);return n.init.apply(n,arguments),n},addComponent:function(e,t,n){return"function"==typeof t?this[e]=new t(n):"object"==typeof t&&(this[e]=t),this},isInstanceOf:function(e){return"string"==typeof e?o[e].isPrototypeOf(this):e.isPrototypeOf(this)},kill:function(){return this._kill||(this._kill=!0,r.push(this)),this}};return{define:function(e,t){null===a.environment&&(a.environment=i.game()),t&&(e.$parent=t);var n=Object.assign(Object.create(t||a),e);return i.log("Sylx.Entity: Defined new entity",n.name),n},defineAs:function(e,t,n){var i=this.define(t,n);return o[e]=i},create:function(e,t){if("object"==typeof e)return a.create.apply(e,t);if("string"==typeof e){if(o[e])return a.create.apply(o[e],t);throw"Entity definition '"+e+"' does not exist!"}return null},getDefinitionFromName:function(e){return o[e]},_cleanupKilledEntities:function(e){if(0!==r.length){for(var t=0,n=r.length;t<n;t++){var i=e.indexOf(r[t]);"function"==typeof r[t].exit&&r[t].exit(),e.splice(i,1)}return r=[],e}}}}(window,window.Sylx),window.Sylx.Input=function(n,e,t){"use strict";var i={},o=!1,r={down:{},pressed:{},last:{}};return{bind:function(e){for(var t in e)i[e[t]]=t;o||(n.document.addEventListener("keydown",function(e){i[e.keyCode]&&(r.down[i[e.keyCode]]=!0)}),n.document.addEventListener("keyup",function(e){i[e.keyCode]&&(r.down[i[e.keyCode]]=!1)}),o=!0)},pressed:function(e){return r.pressed[e]},down:function(e){return r.down[e]},_update:function(){for(var e in r.down)r.pressed[e]=!r.last[e]&&r.down[e],r.last[e]=r.down[e]}}}(window,window.Sylx),window.Sylx.Map=function(e,s,t){"use strict";var n=Object.assign(Object.create(s.game()),{getTileAt:function(e,t){return e<0||t<0||e>=this.size.x||t>=this.size.y?0:this.data[t][e]}});function a(e){e.data;for(var t=e.tileset,n=e.prerender,i=0;i<n.tilesPerRow;i++)for(var o=0;o<n.tilesPerCol;o++)t.drawTile(e.getTileAt(i+n.topLeft.x,o+n.topLeft.y),n.canvas.context,i*n.tileSize.x,o*n.tileSize.y)}return{create:function(e){var t=Object.assign(Object.create(n),e);return t.prerender=null,s.log("Sylx.Map: Created new map",e.name),t},_render:function(e,t){var n=e.scroll||s.Scene.getCurrent().scroll,i=Math.floor(n.x/e.tileSize.x),o=Math.floor(n.y/e.tileSize.y);e.prerender||(!function(e){var t={};t.tilesPerRow=Math.ceil(s.Canvas.width/e.tileSize.x)+1,t.tilesPerCol=Math.ceil(s.Canvas.height/e.tileSize.y)+1,t.tileSize=e.tileSize;var n=t.tilesPerRow*e.tileSize.x,i=t.tilesPerCol*e.tileSize.y;t.canvas=s.Canvas._createCanvas(n,i,1),t.topLeft=new s.Point(0,0),e.prerender=t}(e),e.prerender.topLeft.x=i,e.prerender.topLeft.y=o,a(e));var r=new s.Point(i-e.prerender.topLeft.x,o-e.prerender.topLeft.y);(r.x||r.y)&&(e.prerender.topLeft.x=i,e.prerender.topLeft.y=o,a(e)),t.drawImage(e.prerender.canvas.element,n.x%e.tileSize.x,n.y%e.tileSize.y,s.Canvas.width,s.Canvas.height,0,0,s.Canvas.width,s.Canvas.height)}}}(window,window.Sylx),window.Sylx.Scene=function(e,s,t){"use strict";var n,i={},o=Object.assign(Object.create(s.game()),{addEntity:function(e){return this.entities.push(e),e},createEntity:function(e){if("string"==typeof e&&(e=s.Entity.getDefinitionFromName(e)),"function"!=typeof e.create)throw"The provided definition does not have a create method!";var t=Array.prototype.slice.call(arguments).slice(1),n=e.create.apply(e,t);return this.entities.push(n),n},getEntitiesByType:function(e){if(0===this.entities.length)return[];var t,n=[];"object"==typeof e?t=e:"string"==typeof e&&(t=s.Entity.getDefinitionFromName(e));for(var i=0,o=this.entities.length;i<o;i++){var r=this.entities[i];r._kill||t.isPrototypeOf(r)&&n.push(r)}return n},setLevel:function(e){var t,n;for(this.maps=new Array(e.map.length),t=0,n=e.map.length;t<n;t++)this.maps[t]=s.Map.create(e.map[t]);for(t=0,n=e.entities.length;t<n;t++)this.createEntity.apply(this,e.entities[t])}});return{create:function(e){var t=Object.assign(Object.create(o),e);return t.maps=[],t.entities=[],t.scroll=t.scroll||new s.Point,s.log("Sylx.Scene: Created new scene",e.name),t},createAs:function(e,t){return i[e]=this.create(t),i[e]},getCurrent:function(){return n},set:function(e){var t;if("object"==typeof e)t=e;else if("string"==typeof e){if(!i[name])throw"Scene '"+e+"' has not been created!";t=i[e]}if(!e)throw"Scene is empty!";return this._scheduledSceneToSet=t,this._argumentsForScene=Array.prototype.slice.call(arguments).slice(1),n=t},frozenEntities:!1,_scheduledSceneToSet:null,_argumentsForScene:[]}}(window,window.Sylx),window.Sylx.Tileset=function(n,i,e){"use strict";var o=Object.assign(Object.create(i.game()),{getTileData:function(e){return this.data[e]},getTileProperties:function(e){return"number"==typeof e?this.type[this.data[e]]:this.type[e]},drawTile:function(e,t,n,i){var o=this.data[e].tile*this.tileSize.x;this.image.data.complete&&t.drawImage(this.image.data,o,0,this.tileSize.x,this.tileSize.y,n,i,this.tileSize.x,this.tileSize.y)}});return{create:function(e){var t=Object.assign(Object.create(o),e);return i.log("Sylx.Tileset: Created new tileset",e.name),t.data||n.console.warn("No data was provided for the tileset."),t}}}(window,window.Sylx);