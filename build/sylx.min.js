!function(i,e){"use strict";var f={$global:{}},u={},o=!1,t=function(){},d={},r=!1,n=!1,a={entities:[]},p={module:function(e,t,n){if(r)throw"Cannot add/overwrite modules when the game system is running!";o||(o=!0,i.addEventListener("load",l,!1)),u[e]={name:e,dependencies:t,body:n,loaded:!1},h(u[e])},addToEnvironment:function(e,t){if(f[e])throw"The object name "+e+" is already in use! Please make sure you're not overwriting an already imported module.";f[e]="object"==typeof t?Object.assign(Object.create(f),t):t},game:function(){return f},Point:function(e,t){this.x=parseInt(e)||0,this.y=parseInt(t)||0},run:function(e){t=e},log:function(){this.verbose&&console.log.apply(null,arguments)},VERSION:5,verbose:!1};function h(e,t){if(0===e.dependencies.length)s(e);else{for(var n=!0,i=0;i<e.dependencies.length;i++){var o=u[e.dependencies[i]],r=!1;o&&o.loaded&&(r=!0),r||(p.log("Sylx: Dependency not loaded yet, adding "+e.name+" to queue"),d[e.dependencies[i]]=d[e.dependencies[i]]||[],d[e.dependencies[i]].push(e.name),n=!1)}n&&(s(e),t&&d[t].splice(d[t].indexOf(e.name),1))}}function s(e){var t=0,n={};if(p.log("Sylx: Initializing module "+e.name),"function"==typeof e.body){var i=[];if(e.dependencies.length)for(t=0;t<e.dependencies.length;t++){var o=u[e.dependencies[t]];o.contents?i.push(o.contents):i.push(o.body)}e.body=e.body.apply(f,i)||{}}n=Object.getPrototypeOf(e.body)===Object.prototype?Object.assign(Object.create(f),e.body):e.body;var r=e.name.split("."),a=f,s="",l="";for(t=0;t<r.length;t++){var c=r[t];s+=c,parseInt(t)===r.length-1?(a[c]=n,l&&u[l]&&(u[l].contents[c]=n)):(u[s]=u[s]||{contents:{}},a[c]=a[c]||{},a=a[c]),l=s,s+="."}if("function"==typeof n.onload&&n.onload(),e.loaded=!0,d[e.name])for(t=d[e.name].length-1;0<=t;t--)h(u[d[e.name][t]],e.name)}function l(){if(c()&&(p.log("Sylx: Checking content folders for missing dependencies"),Object.keys(u).forEach(function(e){var t=u[e];if(t.contents&&(t.loaded=!0,d[e]))for(var n=d[e].length-1;0<=n;n--)h(u[d[e][n]],e)}),c()))throw"UNRESOLVED DEPENDENCIES!";p.log("Sylx: All modules loaded successfully!"),function(e){0<d.length&&console.warn("There is unresolved dependencies! Your game might not have loaded properly.",d);"function"==typeof e&&e.call(f);r=!0,p.log("Sylx: Game is now running!"),i.requestAnimationFrame(function e(){i.stats&&i.stats.begin();n||m();n?v():g();p.Entity._cleanupKilledEntities(a.entities);p.Scene._scheduledSceneToSet&&(a&&"function"==typeof a.exit&&a.exit(f),"function"==typeof(a=p.Scene._scheduledSceneToSet).preload&&a.preload.apply(a,p.Scene._argumentsForScene),p.Resource.isLoading()?n=!0:y(),p.Scene._scheduledSceneToSet=null);n&&(p.Resource.isLoading()||(n=!1,y()));0;i.stats&&i.stats.end();r&&i.requestAnimationFrame(e.bind(f))}.bind(f))}.call(p,t)}function c(){var t=!1;return Object.keys(d).forEach(function(e){d[e].length&&(t=!0)}),t}function y(){"function"==typeof a.init&&a.init.apply(a,p.Scene._argumentsForScene),p.log("Sylx: Setting scene",a.name||"")}function m(){if(p.Input._update(),a&&("function"==typeof a.update&&a.update(f),!a.frozenEntities))for(var e=0,t=a.entities.length;e<t;e++){var n=a.entities[e];if(!n._kill&&("function"==typeof n.update&&n.update.call(n,f),n.movement&&p.Component.System.movement(n),n.animator&&p.Component.System.animator(n),n.collision&&(n.collision.collidesWith=[]),e<t))for(var i=e+1;i<t;i++){var o=a.entities[i];n.collision&&o.collision&&p.Component.System.collision(n,o)}}}function g(){var e=p.Canvas.get("buffer"),t=e.context;if(t.globalAlpha=1,p.Canvas.autoClear&&e.clear(),a){if("function"==typeof a.renderBefore&&a.renderBefore(t),a.maps)for(var n=0;n<a.maps.length;n++)p.Map.render(a.maps[n],t);a.entities.sort(function(e,t){return e.zOrder-t.zOrder});for(var i=0,o=a.entities.length;i<o;i++){var r=a.entities[i];r._kill||(r.sprite&&p.Component.System.sprite(r,t),"function"==typeof r.render&&r.render(t))}"function"==typeof a.renderAfter&&a.renderAfter(t)}"number"==typeof a.opacity?p.Canvas.get("main").context.globalAlpha=a.opacity:p.Canvas.get("main").context.globalAlpha=1,p.Canvas.autoCopy&&p.Canvas.copyMain()}function v(){var e=p.Canvas.get("buffer"),t=e.context;p.Canvas.autoClear&&e.clear();var n=p.Resource.getProgress()||.5,i=255*n;t.globalAlpha=.5,t.lineWidth=1,t.fillStyle="rgb("+Math.floor(255-i)+", "+Math.floor(i)+", 128)",t.fillRect(0,p.Canvas.height-2,p.Canvas.width*n,2),p.Canvas.autoCopy&&p.Canvas.copyMain()}i.Sylx?i.Sylx=Object.assign(i.Sylx,p):i.Sylx=p}(window),window.Sylx.Canvas=function(o,r,e){"use strict";var a={},s={clear:function(e){this.context.fillStyle=e||this.fillColor||c.fillColor,this.context.fillRect(0,0,this.width,this.height)},copyTo:function(e,t){t||e.context.clearRect(0,0,e.width,e.height),e.context.drawImage(this.element,0,0)}};function l(e,t,n){var i=Object.assign(Object.create(s),{element:o.document.createElement("canvas"),width:e,height:t,scale:n});return i.context=i.element.getContext("2d"),i.element.width=e,i.element.height=t,i.context.fillStyle=c.fillColor,i.context.imageSmoothingEnabled=!1,i.context.mozImageSmoothingEnabled=!1,i.context.oImageSmoothingEnabled=!1,i.context.webkitImageSmoothingEnabled=!1,i.context.msImageSmoothingEnabled=!1,i.offset=new r.Point,i}var c={create:function(e,t,n){if(!e&&!t)throw"Must provide dimensions for canvas!";(n=n||{}).scale=n.scale||1;var i=function(e){if(1<e.scale){var t=e.width*e.scale,n=e.height*e.scale;e.element.style.width=t+"px",e.element.style.height=n+"px",e.element.style.imageRendering="-moz-crisp-edges",e.element.style.imageRendering="-webkit-crisp-edges",e.element.style.imageRendering="pixelated",e.element.style.imageRendering="crisp-edges",e.element.style.msInterpolationMode="nearest-neighbor"}return e}(l(e,t,n.scale));return n.isMain&&!a.main&&(a.main=i,a.buffer=l(e,t,1),function(e,t){var n;if("string"==typeof e){if(void 0===(n=o.document.getElementById(e)))return o.console.error('Element "'+e+'" was not found!')}else"object"==typeof e&&"function"==typeof e.appendChild&&e.nodeType&&(n=e);n.appendChild(t)}(n.appendTo||document.body,i.element),c.width=e,c.height=t,c.scale=n.scale),i},get:function(e){if(a[e])return a[e]},copyMain:function(){a.buffer.copyTo(a.main)},autoClear:!0,autoCopy:!0,fillColor:"#000000",width:null,height:null,scale:null};return c}(window,window.Sylx),window.Sylx.Component=function(e,l,t){"use strict";var n={sprite:function(e){return e||(e={}),this.position=e.position||new l.Point,this.size=e.size||new l.Point(16,16),this.offset=e.offset||new l.Point,this.sourcePosition=e.sourcePosition||new l.Point,this.image=e.image||null,this.visible=e.visible||!0,this.opacity=e.opacity||1,this.order=e.order||0,this.fixed=e.fixed||!1,this},movement:function(e){return e||(e={}),this.speed=e.speed||new l.Point,this.acceleration=e.acceleration||new l.Point,this.duration=0,this},collision:function(){return this.collidesWith=[],this},animator:function(e){return this.collection=e.collection||{},this.current=e.current||null,this.next=null,this.step=0,this.timeleft=0,this.frame=0,this.flip={x:!1,y:!1},this}};return{getConstructor:function(e){return e?n[e]:n},createComponent:function(e,t){if(n[e])throw"Component constructor "+e+" already exists!";n[e]=t},Constructor:n,System:{sprite:function(e,t){var n,i=e.sprite;if(!i.visible)return null;if(i.image.data&&i.image.data instanceof HTMLImageElement){if(!0,!(n=i.image.data).complete)return null}else{if(!i.image.element||"CANVAS"!==i.image.element.nodeName)throw"Can't determine if element is image or canvas!";!0,n=i.image.element}if(n){var o=l.Scene.getCurrent().scroll,r=i.position.x-i.offset.x-(i.fixed?0:o.x),a=i.position.y-i.offset.y-(i.fixed?0:o.y);if(r>l.Canvas.width||a>l.Canvas.height||r<-i.size.x||a<-i.size.y)return null;"number"==typeof i.opacity?t.globalAlpha=i.opacity:t.globalAlpha=1;var s={x:1,y:1};i.flip&&(i.flip.x&&(s.x=-1),i.flip.y&&(s.y=-1)),-1!==s.x&&-1!==s.y||t.scale(s.x,s.y),t.drawImage(n,i.sourcePosition.x,i.sourcePosition.y,i.size.x,i.size.y,r*s.x-(-1===s.x?i.size.x:0),a*s.y-(-1===s.y?i.size.y:0),i.size.x,i.size.y),-1!==s.x&&-1!==s.y||t.scale(s.x,s.y)}},movement:function(e){if(!e.sprite)return null;var t=e.sprite,n=e.movement;t.position.x+=n.speed.x,t.position.y+=n.speed.y,n.speed.x+=n.acceleration.x,n.speed.y+=n.acceleration.y,n.duration&&(n.duration--,0===n.duration&&(n.speed.x=0,n.speed.y=0,n.acceleration.x=0,n.acceleration.y=0))},collision:function(e,t){var n=e.sprite,i=t.sprite;n.position.x<i.position.x+i.size.x&&n.position.x+n.size.x>i.position.x&&n.position.y<i.position.y+i.size.y&&n.size.y+n.position.y>i.position.y&&(e.collision.collidesWith.push(t),t.collision.collidesWith.push(e))},animator:function(e){if(!e.sprite)return null;var t=e.animator;e.sprite;if(t.next&&(t.current=t.next,t.step=0,t.timeleft=t.collection[t.current].duration,t.frame=t.collection[t.current].cycle[0],t.flip.x=t.collection[t.current].flipX||!1,t.flip.y=t.collection[t.current].flipY||!1,t.next=null,this.spritesheet(e)),!t.current)return null;var n=t.collection[t.current];if(t.timeleft<0)return null;t.timeleft--,t.timeleft<=0&&(t.step++,t.step===n.cycle.length&&(t.step=0),t.timeleft=n.duration,t.frame=n.cycle[t.step],this.spritesheet(e))},spritesheet:function(e){if(e.spritesheet){var t=e.spritesheet[e.animator.frame];e.sprite.sourcePosition=t.position,e.sprite.size=t.size||e.sprite.size,e.sprite.offset=t.offset||e.sprite.offset}else e.sprite.sourcePosition.x=e.animator.frame*e.sprite.size.x,e.sprite.sourcePosition.y=0;e.sprite.flip=e.animator.flip}}}}(window,window.Sylx),window.Sylx.Entity=function(e,i,t){"use strict";var o={},r=[],a=function(){return this._kill=!1,this},s={constructor:null,environment:null,init:function(){},update:function(){},create:function(){var e=this.constructor||a,t=e.apply(Object.create(e.prototype),arguments),n=Object.assign(Object.create(this),t);return n.init.apply(n,arguments),n},addComponent:function(e,t,n){return"function"==typeof t?this[e]=new t(n):"object"==typeof t&&(this[e]=t),this},isInstanceOf:function(e){return"string"==typeof e?o[e].isPrototypeOf(this):e.isPrototypeOf(this)},kill:function(){return this._kill||(this._kill=!0,r.push(this)),this}};return{define:function(e,t){null===s.environment&&(s.environment=i.game()),t&&(e.$parent=t);var n=Object.assign(Object.create(t||s),e);return i.log("Sylx.Entity: Defined new entity",n.name),n},defineAs:function(e,t,n){var i=this.define(t,n);return o[e]=i},create:function(e,t){if("object"==typeof e)return s.create.apply(e,t);if("string"!=typeof e)return null;if(o[e])return s.create.apply(o[e],t);throw"Entity definition '"+e+"' does not exist!"},getDefinitionFromName:function(e){return o[e]},_cleanupKilledEntities:function(e){if(0!==r.length){for(var t=r.length-1;0<=t;t--){var n=e.indexOf(r[t]);"function"==typeof r[t].exit&&r[t].exit(),e.splice(n,1),r.splice(t,1)}return e}}}}(window,window.Sylx),window.Sylx.Input=function(n,e,t){"use strict";var i={},o=!1,r={down:{},pressed:{},last:{}};return{bind:function(e){for(var t in e)i[e[t]]=t;o||(n.document.addEventListener("keydown",function(e){i[e.keyCode]&&(r.down[i[e.keyCode]]=!0)}),n.document.addEventListener("keyup",function(e){i[e.keyCode]&&(r.down[i[e.keyCode]]=!1)}),o=!0)},pressed:function(e){return r.pressed[e]},down:function(e){return r.down[e]},_update:function(){for(var e in r.down)r.pressed[e]=!r.last[e]&&r.down[e],r.last[e]=r.down[e]}}}(window,window.Sylx),window.Sylx.Map=function(e,a,t){"use strict";var i=Object.assign(Object.create(a.game()),{getTileAt:function(e,t){return e<0||t<0||e>=this.size.x||t>=this.size.y?0:this.data[t][e]},setTile:function(e,t,n,i){if(t<0||n<0||t>=this.size.x||n>=this.size.y)return null;if(this.data[n][t]=e,!i){if(!this.prerender)return void console.warn("Tried to draw to map while prerender is not ready!");var o=(t-this.prerender.topLeft.x)*this.prerender.tileSize.x,r=(n-this.prerender.topLeft.y)*this.prerender.tileSize.y;0<=o&&0<=r&&o<this.prerender.canvas.width&&r<this.prerender.canvas.height&&l(this,e,o,r)}}});function s(e){e.data,e.tileset;for(var t=e.prerender,n=0;n<t.tilesPerRow;n++)for(var i=0;i<t.tilesPerCol;i++)l(e,e.getTileAt(n+t.topLeft.x,i+t.topLeft.y),n*t.tileSize.x,i*t.tileSize.y)}function l(e,t,n,i){e.tileset.data&&e.tileset.data.complete&&e.prerender.canvas.context.drawImage(e.tileset.data,t*e.tileSize.x,0,e.tileSize.x,e.tileSize.y,n,i,e.tileSize.x,e.tileSize.y)}return{create:function(e){var t=Object.assign(Object.create(i),e);if(t.prerender=null,t.size&&!t.data){t.data=new Array(t.size.y);for(var n=0;n<t.size.y;n++)t.data[n]=new Array(t.size.x).fill(0)}return a.log("Sylx.Map: Created new map",e.name),t},render:function(e,t){if(!e.tileset||!e.tileSize)return null;var n=e.scroll||a.Scene.getCurrent().scroll,i=Math.floor(n.x/e.tileSize.x),o=Math.floor(n.y/e.tileSize.y);e.prerender||(!function(e){var t={};t.tilesPerRow=Math.ceil(a.Canvas.width/e.tileSize.x)+1,t.tilesPerCol=Math.ceil(a.Canvas.height/e.tileSize.y)+1,t.tileSize=e.tileSize;var n=t.tilesPerRow*e.tileSize.x,i=t.tilesPerCol*e.tileSize.y;t.canvas=a.Canvas.create(n,i),t.topLeft=new a.Point(0,0),e.prerender=t}(e),e.prerender.topLeft.x=i,e.prerender.topLeft.y=o,s(e));var r=new a.Point(i-e.prerender.topLeft.x,o-e.prerender.topLeft.y);(r.x||r.y)&&(e.prerender.topLeft.x=i,e.prerender.topLeft.y=o,s(e)),"number"==typeof e.opacity?t.globalAlpha=e.opacity:t.globalAlpha=1,t.drawImage(e.prerender.canvas.element,n.x%e.tileSize.x,n.y%e.tileSize.y,a.Canvas.width,a.Canvas.height,0,0,a.Canvas.width,a.Canvas.height)}}}(window,window.Sylx),window.Sylx.Resource=function(n,e,t){"use strict";var o={},r=[],a=!1,s=!1;function i(e){var t=!0;for(var n in o)o[n].loaded||(t=!1);t&&(s=a=!1,"function"==typeof e&&e())}function l(e){for(var t=r.length-1;0<=t;t--){var n=r[t];o[n].loaded&&r.splice(t,1)}0===r.length&&(s=a=!1,"function"==typeof e&&e())}var c={image:function(e,t){this.data=new n.Image,this.data.src=this.path,this.data.onload=function(){this.loaded=!0,s||(a=!1),"function"==typeof e&&e(this.data)}.bind(this)},json:function(n,i){var o=new XMLHttpRequest;o.open("GET",this.path,!0),o.responseType="json",o.onload=function(){var e=o.status,t=o.response;if(200!==e)throw i(t),this.path,t;this.data=t,this.loaded=!0,s||(a=!1),"function"==typeof n&&n(t)}.bind(this),o.send()}},f={load:function(e,t){if(this.loaded)return this;if(!s){if(a)return this;a=!0}var n=function(e){var t=e.split(".");switch(1===t.length||""===t[0]&&2===t.length?"":t.pop().toLowerCase()){case"png":case"gif":case"jpg":return"image";case"json":return"json"}}(this.path);if(!c[n])throw"Unknown or unsupported resource type.";return c[n].call(this,e,t),this}};return{create:function(e,t){return o[e]||(o[e]=Object.assign(Object.create(f),{path:e,data:null,loaded:!1})),o[e]},loadAllCreated:function(e,t){if(a)return null;for(var n in s=a=!0,o)o[n].loaded||o[n].load(i.bind(null,e),t);return this},queue:function(){if(0===arguments.length)return null;for(var e=0;e<arguments.length;e++){var t=arguments[e];"string"==typeof t?-1===r.indexOf(t)&&r.push(t):"object"==typeof t&&(Array.isArray(t)?this.queue.apply(this,t):"string"==typeof t.path&&this.queue(t.path))}return this},loadQueue:function(e,t){if(a)return null;for(var n in s=a=!0,r){var i=r[n];o[i]||this.create(i),o[i].loaded||o[i].load(l.bind(null,e),t)}},isLoading:function(){return a},getProgress:function(){return a?.5:0},clearCache:function(){for(var e in o)o[e].loaded&&delete o[e]}}}(window,window.Sylx),window.Sylx.Scene=function(e,a,t){"use strict";var n,i={},o=Object.assign(Object.create(a.game()),{addEntity:function(e){return this.entities.push(e),e},createEntity:function(e){if("string"==typeof e&&(e=a.Entity.getDefinitionFromName(e)),"function"!=typeof e.create)throw"The provided definition does not have a create method!";var t=Array.prototype.slice.call(arguments).slice(1),n=e.create.apply(e,t);return this.entities.push(n),n},getEntitiesByType:function(e){if(0===this.entities.length)return[];var t,n=[];"object"==typeof e?t=e:"string"==typeof e&&(t=a.Entity.getDefinitionFromName(e));for(var i=0,o=this.entities.length;i<o;i++){var r=this.entities[i];r._kill||t.isPrototypeOf(r)&&n.push(r)}return n},setLevel:function(e){var t,n;for(this.maps=new Array(e.map.length),t=0,n=e.map.length;t<n;t++)this.maps[t]=a.Map.create(e.map[t]);for(t=0,n=e.entities.length;t<n;t++)this.createEntity.apply(this,e.entities[t])},getMap:function(e){if(this.maps)return this.maps[e]},addMap:function(e){this.maps||(this.maps=[]),this.maps.push(e)},removeMap:function(e){if(!this.maps)return null;"object"==typeof e&&(e=this.maps.indexOf(e)),0<=e&&e<this.maps.length&&this.maps.splice(e,1)}});return{create:function(e){var t=Object.assign(Object.create(o),e);return t.maps=[],t.entities=[],t.scroll=t.scroll||new a.Point,a.log("Sylx.Scene: Created new scene",e.name),t},createAs:function(e,t){return i[e]=this.create(t),i[e]},getCurrent:function(){return n},set:function(e){var t;if("object"==typeof e)t=e;else if("string"==typeof e){if(!i[name])throw"Scene '"+e+"' has not been created!";t=i[e]}if(!e)throw"Scene is empty!";return this._scheduledSceneToSet=t,this._argumentsForScene=Array.prototype.slice.call(arguments).slice(1),n=t},frozenEntities:!1,_scheduledSceneToSet:null,_argumentsForScene:[]}}(window,window.Sylx),window.Sylx.Text=function(o,e,t){"use strict";var c={},f=null;return{registerFont:function(e,t,n){var i=n?Object.assign({},n):{};if(!i.firstCharCode)throw"Missing property: firstCharCode";if(!i.characterWidth)throw"Missing property: characterWidth";if("string"==typeof t)i.bitmap=new o.Image,i.bitmap.src=t;else{if("object"!=typeof t)throw"Unknown bitmap format provided.";t.data&&(i.bitmap=t.data)}n.setAsDefault&&(f=e),c[e]=i},renderText:function(e,t,n,i,o){o=o||{};var r="string"==typeof e?e:e.toString();o.noTrim||(r=r.trim());for(var a=o.font?c[o.font]:c[f],s=0;s<r.length;s++){var l=r.charCodeAt(s);l>=a.firstCharCode&&l<=a.lastCharCode&&i.drawImage(a.bitmap,(l-a.firstCharCode)*a.characterWidth,0,a.characterWidth,a.characterHeight,t+s*a.characterWidth,n,a.characterWidth,a.characterHeight)}},createPrerenderImage:function(){}}}(window,window.Sylx);