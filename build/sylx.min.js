!function(t,e){"use strict";var s={$global:{}},l={},c={},i=!1,n=!1,r={entities:[]},f={module:function(e,t,n){if(i)throw"Cannot add/overwrite modules when the game system is running!";l[e]={name:e,dependencies:t,body:n,loaded:!1},u(l[e])},addToEnvironment:function(e,t){if(s[e])throw"The object name "+e+" is already in use! Please make sure you're not overwriting an already imported module.";s[e]="object"==typeof t?Object.assign(Object.create(s),t):t},game:function(){return s},Point:function(e,t){this.x=parseInt(e)||0,this.y=parseInt(t)||0},run:function(e){"complete"===t.document.readyState?o(e):t.addEventListener("load",o.bind(this,e),!1)},log:function(){this.verbose&&console.log.apply(null,arguments)},VERSION:5,verbose:!1};function u(e,t){if(0===e.dependencies.length)a(e);else{for(var n=!0,i=0;i<e.dependencies.length;i++){var o=l[e.dependencies[i]],r=!1;o&&o.loaded&&(r=!0),r||(f.log("Sylx: Dependency not loaded yet, adding "+e.name+" to queue"),c[e.dependencies[i]]=c[e.dependencies[i]]||[],c[e.dependencies[i]].push(e.name),n=!1)}n&&(a(e),t&&c[t].splice(c[t].indexOf(e.name),1))}}function a(e){var t=0,n={};if(f.log("Sylx: Initializing module "+e.name),"function"==typeof e.body){var i=[];if(e.dependencies.length)for(t=0;t<e.dependencies.length;t++)i.push(l[e.dependencies[t]].body);e.body=e.body.apply(s,i)||{}}n=Object.getPrototypeOf(e.body)===Object.prototype?Object.assign(Object.create(s),e.body):e.body;var o=e.name.split("."),r=s;for(t=0;t<o.length;t++){var a=o[t];parseInt(t)===o.length-1?r[a]=n:(r[a]=r[a]||{},r=r[a])}if("function"==typeof n.onload&&n.onload(),e.loaded=!0,c[e.name])for(t=c[e.name].length-1;0<=t;t--)u(l[c[e.name][t]],e.name)}function o(e){0<c.length&&console.warn("There is unresolved dependencies! Your game might not have loaded properly.",c),"function"==typeof e&&e.call(s),i=!0,f.log("Sylx: Game is now running!"),t.requestAnimationFrame(function e(){t.stats&&t.stats.begin();n||p();n?y():h();f.Entity._cleanupKilledEntities(r.entities);f.Scene._scheduledSceneToSet&&(r&&"function"==typeof r.exit&&r.exit(s),"function"==typeof(r=f.Scene._scheduledSceneToSet).preload&&r.preload.apply(r,f.Scene._argumentsForScene),f.Resource.isLoading()?n=!0:d(),f.Scene._scheduledSceneToSet=null);n&&(f.Resource.isLoading()||(n=!1,d()));0;t.stats&&t.stats.end();i&&t.requestAnimationFrame(e.bind(s))}.bind(s))}function d(){"function"==typeof r.init&&r.init.apply(r,f.Scene._argumentsForScene),f.log("Sylx: Setting scene",r.name||"")}function p(){if(f.Input._update(),r&&("function"==typeof r.update&&r.update(s),!r.frozenEntities))for(var e=0,t=r.entities.length;e<t;e++){var n=r.entities[e];if(!n._kill&&("function"==typeof n.update&&n.update.call(n,s),n.movement&&f.Component.System.movement(n),n.animator&&f.Component.System.animator(n),n.collision&&(n.collision.collidesWith=[]),e<t))for(var i=e+1;i<t;i++){var o=r.entities[i];n.collision&&o.collision&&f.Component.System.collision(n,o)}}}function h(){var e=f.Canvas.getContext("buffer");if(e.globalAlpha=1,f.Canvas.autoClear&&f.Canvas.clearCanvas("buffer"),r){if("function"==typeof r.renderBefore&&r.renderBefore(e),r.maps)for(var t=0;t<r.maps.length;t++)f.Map._render(r.maps[t],e);r.entities.sort(function(e,t){return e.zOrder-t.zOrder});for(var n=0,i=r.entities.length;n<i;n++){var o=r.entities[n];o._kill||(o.sprite&&f.Component.System.sprite(o,e),"function"==typeof o.render&&o.render(e))}"function"==typeof r.renderAfter&&r.renderAfter(e)}"number"==typeof r.opacity?f.Canvas.getContext("main").globalAlpha=r.opacity:f.Canvas.getContext("main").globalAlpha=1,f.Canvas.autoCopy&&f.Canvas.copy()}function y(){var e=f.Canvas.getContext("buffer");f.Canvas.autoClear&&f.Canvas.clearCanvas("buffer");var t=f.Resource.getProgress()||.5,n=255*t;e.globalAlpha=.5,e.lineWidth=1,e.fillStyle="rgb("+Math.floor(255-n)+", "+Math.floor(n)+", 128)",e.fillRect(0,f.Canvas.height-2,f.Canvas.width*t,2),f.Canvas.autoCopy&&f.Canvas.copy()}t.Sylx?t.Sylx=Object.assign(t.Sylx,f):t.Sylx=f}(window),window.Sylx.Canvas=function(o,e,t){"use strict";var n,i,r,a={},s={create:function(e){if(a.main)return console.warn("$display.create should only be called once."),null;n=e.width||320,i=e.height||240,r=e.scale||1,a.main=function(e){if(1<e.scale){var t=e.width*e.scale,n=e.height*e.scale;e.element.style.width=t+"px",e.element.style.height=n+"px",e.element.style.imageRendering="-moz-crisp-edges",e.element.style.imageRendering="-webkit-crisp-edges",e.element.style.imageRendering="pixelated",e.element.style.imageRendering="crisp-edges",e.element.style.msInterpolationMode="nearest-neighbor"}return e}(this._createCanvas(n,i,r)),a.buffer=this._createCanvas(n,i,1),function(e,t){var n;if("string"==typeof e){if(void 0===(n=o.document.getElementById(e)))return o.console.error('Element "'+e+'" was not found!')}else"object"==typeof e&&"function"==typeof e.appendChild&&e.nodeType&&(n=e);n.appendChild(t)}(e.appendTo||document.body,a.main.element),this.width=n,this.height=i,this.scale=r},getContext:function(e){return a[e]?a[e].context:null},clearCanvas:function(e){if(!a[e])return null;var t=a[e];t.context.fillStyle=this.fillColor,t.context.fillRect(0,0,t.width,t.height)},copy:function(){a.main.context.clearRect(0,0,n,i),a.main.context.drawImage(a.buffer.element,0,0)},_createCanvas:function(e,t,n){var i={element:o.document.createElement("canvas"),width:e,height:t,scale:n};return i.context=i.element.getContext("2d"),i.element.width=e,i.element.height=t,i.context.fillStyle=s.fillColor,i.context.imageSmoothingEnabled=!1,i.context.mozImageSmoothingEnabled=!1,i.context.oImageSmoothingEnabled=!1,i.context.webkitImageSmoothingEnabled=!1,i.context.msImageSmoothingEnabled=!1,i},autoClear:!0,autoCopy:!0,fillColor:"#000000",width:null,height:null,scale:null,offset:{x:0,y:0}};return s}(window,window.Sylx),window.Sylx.Component=function(e,l,t){"use strict";var n={sprite:function(e){return e||(e={}),this.position=e.position||new l.Point,this.size=e.size||new l.Point(16,16),this.offset=e.offset||new l.Point,this.sourcePosition=e.sourcePosition||new l.Point,this.image=e.image||null,this.visible=e.visible||!0,this.opacity=e.opacity||1,this.order=e.order||0,this.fixed=e.fixed||!1,this},movement:function(e){return e||(e={}),this.speed=e.speed||new l.Point,this.acceleration=e.acceleration||new l.Point,this.duration=0,this},collision:function(){return this.collidesWith=[],this},animator:function(e){return this.collection=e.collection||{},this.current=e.current||null,this.next=null,this.step=0,this.timeleft=0,this.frame=0,this.flip={x:!1,y:!1},this}};return{getConstructor:function(e){return e?n[e]:n},createComponent:function(e,t){if(n[e])throw"Component constructor "+e+" already exists!";n[e]=t},Constructor:n,System:{sprite:function(e,t){var n,i=e.sprite;if(!i.visible)return null;if(i.image.data&&i.image.data instanceof HTMLImageElement){if(!0,!(n=i.image.data).complete)return null}else{if(!i.image.element||"CANVAS"!==i.image.element.nodeName)throw"Can't determine if element is image or canvas!";!0,n=i.image.element}if(n){var o=l.Scene.getCurrent().scroll,r=i.position.x-i.offset.x-(i.fixed?0:o.x),a=i.position.y-i.offset.y-(i.fixed?0:o.y);if(r>l.Canvas.width||a>l.Canvas.height||r<-i.size.x||a<-i.size.y)return null;"number"==typeof i.opacity?t.globalAlpha=i.opacity:t.globalAlpha=1;var s={x:1,y:1};i.flip&&(i.flip.x&&(s.x=-1),i.flip.y&&(s.y=-1)),-1!==s.x&&-1!==s.y||t.scale(s.x,s.y),t.drawImage(n,i.sourcePosition.x,i.sourcePosition.y,i.size.x,i.size.y,r*s.x-(-1===s.x?i.size.x:0),a*s.y-(-1===s.y?i.size.y:0),i.size.x,i.size.y),-1!==s.x&&-1!==s.y||t.scale(s.x,s.y)}},movement:function(e){if(!e.sprite)return null;var t=e.sprite,n=e.movement;t.position.x+=n.speed.x,t.position.y+=n.speed.y,n.speed.x+=n.acceleration.x,n.speed.y+=n.acceleration.y,n.duration&&(n.duration--,0===n.duration&&(n.speed.x=0,n.speed.y=0,n.acceleration.x=0,n.acceleration.y=0))},collision:function(e,t){var n=e.sprite,i=t.sprite;n.position.x<i.position.x+i.size.x&&n.position.x+n.size.x>i.position.x&&n.position.y<i.position.y+i.size.y&&n.size.y+n.position.y>i.position.y&&(e.collision.collidesWith.push(t),t.collision.collidesWith.push(e))},animator:function(e){if(!e.sprite)return null;var t=e.animator;e.sprite;if(t.next&&(t.current=t.next,t.step=0,t.timeleft=t.collection[t.current].duration,t.frame=t.collection[t.current].cycle[0],t.flip.x=t.collection[t.current].flipX||!1,t.flip.y=t.collection[t.current].flipY||!1,t.next=null,this.spritesheet(e)),!t.current)return null;var n=t.collection[t.current];if(t.timeleft<0)return null;t.timeleft--,t.timeleft<=0&&(t.step++,t.step===n.cycle.length&&(t.step=0),t.timeleft=n.duration,t.frame=n.cycle[t.step],this.spritesheet(e))},spritesheet:function(e){if(e.spritesheet){var t=e.spritesheet[e.animator.frame];e.sprite.sourcePosition=t.position,e.sprite.size=t.size||e.sprite.size,e.sprite.offset=t.offset||e.sprite.offset}else e.sprite.sourcePosition.x=e.animator.frame*e.sprite.size.x,e.sprite.sourcePosition.y=0;e.sprite.flip=e.animator.flip}}}}(window,window.Sylx),window.Sylx.Entity=function(e,i,t){"use strict";var o={},r=[],a=function(){return this._kill=!1,this},s={constructor:null,environment:null,init:function(){},update:function(){},create:function(){var e=this.constructor||a,t=e.apply(Object.create(e.prototype),arguments),n=Object.assign(Object.create(this),t);return n.init.apply(n,arguments),n},addComponent:function(e,t,n){return"function"==typeof t?this[e]=new t(n):"object"==typeof t&&(this[e]=t),this},isInstanceOf:function(e){return"string"==typeof e?o[e].isPrototypeOf(this):e.isPrototypeOf(this)},kill:function(){return this._kill||(this._kill=!0,r.push(this)),this}};return{define:function(e,t){null===s.environment&&(s.environment=i.game()),t&&(e.$parent=t);var n=Object.assign(Object.create(t||s),e);return i.log("Sylx.Entity: Defined new entity",n.name),n},defineAs:function(e,t,n){var i=this.define(t,n);return o[e]=i},create:function(e,t){if("object"==typeof e)return s.create.apply(e,t);if("string"!=typeof e)return null;if(o[e])return s.create.apply(o[e],t);throw"Entity definition '"+e+"' does not exist!"},getDefinitionFromName:function(e){return o[e]},_cleanupKilledEntities:function(e){if(0!==r.length){for(var t=0,n=r.length;t<n;t++){var i=e.indexOf(r[t]);"function"==typeof r[t].exit&&r[t].exit(),e.splice(i,1)}return r=[],e}}}}(window,window.Sylx),window.Sylx.Input=function(n,e,t){"use strict";var i={},o=!1,r={down:{},pressed:{},last:{}};return{bind:function(e){for(var t in e)i[e[t]]=t;o||(n.document.addEventListener("keydown",function(e){i[e.keyCode]&&(r.down[i[e.keyCode]]=!0)}),n.document.addEventListener("keyup",function(e){i[e.keyCode]&&(r.down[i[e.keyCode]]=!1)}),o=!0)},pressed:function(e){return r.pressed[e]},down:function(e){return r.down[e]},_update:function(){for(var e in r.down)r.pressed[e]=!r.last[e]&&r.down[e],r.last[e]=r.down[e]}}}(window,window.Sylx),window.Sylx.Map=function(e,a,t){"use strict";var i=Object.assign(Object.create(a.game()),{getTileAt:function(e,t){return e<0||t<0||e>=this.size.x||t>=this.size.y?0:this.data[t][e]},setTile:function(e,t,n,i){if(t<0||n<0||t>=this.size.x||n>=this.size.y)return null;if(this.data[n][t]=e,!i){if(!this.prerender)return void console.warn("Tried to draw to map while prerender is not ready!");var o=(t-this.prerender.topLeft.x)*this.prerender.tileSize.x,r=(n-this.prerender.topLeft.y)*this.prerender.tileSize.y;0<=o&&0<=r&&o<this.prerender.canvas.width&&r<this.prerender.canvas.height&&l(this,e,o,r)}}});function s(e){e.data,e.tileset;for(var t=e.prerender,n=0;n<t.tilesPerRow;n++)for(var i=0;i<t.tilesPerCol;i++)l(e,e.getTileAt(n+t.topLeft.x,i+t.topLeft.y),n*t.tileSize.x,i*t.tileSize.y)}function l(e,t,n,i){e.tileset.data&&e.tileset.data.complete&&e.prerender.canvas.context.drawImage(e.tileset.data,t*e.tileSize.x,0,e.tileSize.x,e.tileSize.y,n,i,e.tileSize.x,e.tileSize.y)}return{create:function(e){var t=Object.assign(Object.create(i),e);if(t.prerender=null,t.size&&!t.data){t.data=new Array(t.size.y);for(var n=0;n<t.size.y;n++)t.data[n]=new Array(t.size.x).fill(0)}return a.log("Sylx.Map: Created new map",e.name),t},_render:function(e,t){if(!e.tileset||!e.tileSize)return null;var n=e.scroll||a.Scene.getCurrent().scroll,i=Math.floor(n.x/e.tileSize.x),o=Math.floor(n.y/e.tileSize.y);e.prerender||(!function(e){var t={};t.tilesPerRow=Math.ceil(a.Canvas.width/e.tileSize.x)+1,t.tilesPerCol=Math.ceil(a.Canvas.height/e.tileSize.y)+1,t.tileSize=e.tileSize;var n=t.tilesPerRow*e.tileSize.x,i=t.tilesPerCol*e.tileSize.y;t.canvas=a.Canvas._createCanvas(n,i,1),t.topLeft=new a.Point(0,0),e.prerender=t}(e),e.prerender.topLeft.x=i,e.prerender.topLeft.y=o,s(e));var r=new a.Point(i-e.prerender.topLeft.x,o-e.prerender.topLeft.y);(r.x||r.y)&&(e.prerender.topLeft.x=i,e.prerender.topLeft.y=o,s(e)),"number"==typeof e.opacity?t.globalAlpha=e.opacity:t.globalAlpha=1,t.drawImage(e.prerender.canvas.element,n.x%e.tileSize.x,n.y%e.tileSize.y,a.Canvas.width,a.Canvas.height,0,0,a.Canvas.width,a.Canvas.height)}}}(window,window.Sylx),window.Sylx.Resource=function(n,e,t){"use strict";var o={},r=[],a=!1,s=!1;function i(e){var t=!0;for(var n in o)o[n].loaded||(t=!1);t&&(s=a=!1,"function"==typeof e&&e())}function l(e){for(var t=r.length-1;0<=t;t--){var n=r[t];o[n].loaded&&r.splice(t,1)}0===r.length&&(s=a=!1,"function"==typeof e&&e())}var c={image:function(e,t){this.data=new n.Image,this.data.src=this.path,this.data.onload=function(){this.loaded=!0,s||(a=!1),"function"==typeof e&&e(this.data)}.bind(this)},json:function(n,i){var o=new XMLHttpRequest;o.open("GET",this.path,!0),o.responseType="json",o.onload=function(){var e=o.status,t=o.response;if(200!==e)throw i(t),this.path,t;this.data=t,this.loaded=!0,s||(a=!1),"function"==typeof n&&n(t)}.bind(this),o.send()}},f={load:function(e,t){if(this.loaded)return this;if(!s){if(a)return this;a=!0}var n=function(e){var t=e.split(".");switch(1===t.length||""===t[0]&&2===t.length?"":t.pop().toLowerCase()){case"png":case"gif":case"jpg":return"image";case"json":return"json"}}(this.path);if(!c[n])throw"Unknown or unsupported resource type.";return c[n].call(this,e,t),this}};return{create:function(e,t){return o[e]||(o[e]=Object.assign(Object.create(f),{path:e,data:null,loaded:!1})),o[e]},loadAllCreated:function(e,t){if(a)return null;for(var n in s=a=!0,o)o[n].loaded||o[n].load(i.bind(null,e),t);return this},queue:function(){if(0===arguments.length)return null;for(var e=0;e<arguments.length;e++){var t=arguments[e];"string"==typeof t?-1===r.indexOf(t)&&r.push(t):"object"==typeof t&&(Array.isArray(t)?this.queue.apply(this,t):"string"==typeof t.path&&this.queue(t.path))}return this},loadQueue:function(e,t){if(a)return null;for(var n in s=a=!0,r){var i=r[n];o[i]||this.create(i),o[i].loaded||o[i].load(l.bind(null,e),t)}},isLoading:function(){return a},getProgress:function(){return a?.5:0},clearCache:function(){for(var e in o)o[e].loaded&&delete o[e]}}}(window,window.Sylx),window.Sylx.Scene=function(e,a,t){"use strict";var n,i={},o=Object.assign(Object.create(a.game()),{addEntity:function(e){return this.entities.push(e),e},createEntity:function(e){if("string"==typeof e&&(e=a.Entity.getDefinitionFromName(e)),"function"!=typeof e.create)throw"The provided definition does not have a create method!";var t=Array.prototype.slice.call(arguments).slice(1),n=e.create.apply(e,t);return this.entities.push(n),n},getEntitiesByType:function(e){if(0===this.entities.length)return[];var t,n=[];"object"==typeof e?t=e:"string"==typeof e&&(t=a.Entity.getDefinitionFromName(e));for(var i=0,o=this.entities.length;i<o;i++){var r=this.entities[i];r._kill||t.isPrototypeOf(r)&&n.push(r)}return n},setLevel:function(e){var t,n;for(this.maps=new Array(e.map.length),t=0,n=e.map.length;t<n;t++)this.maps[t]=a.Map.create(e.map[t]);for(t=0,n=e.entities.length;t<n;t++)this.createEntity.apply(this,e.entities[t])},getMap:function(e){if(this.maps)return this.maps[e]},addMap:function(e){this.maps||(this.maps=[]),this.maps.push(e)},removeMap:function(e){if(!this.maps)return null;"object"==typeof e&&(e=this.maps.indexOf(e)),0<=e&&e<this.maps.length&&this.maps.splice(e,1)}});return{create:function(e){var t=Object.assign(Object.create(o),e);return t.maps=[],t.entities=[],t.scroll=t.scroll||new a.Point,a.log("Sylx.Scene: Created new scene",e.name),t},createAs:function(e,t){return i[e]=this.create(t),i[e]},getCurrent:function(){return n},set:function(e){var t;if("object"==typeof e)t=e;else if("string"==typeof e){if(!i[name])throw"Scene '"+e+"' has not been created!";t=i[e]}if(!e)throw"Scene is empty!";return this._scheduledSceneToSet=t,this._argumentsForScene=Array.prototype.slice.call(arguments).slice(1),n=t},frozenEntities:!1,_scheduledSceneToSet:null,_argumentsForScene:[]}}(window,window.Sylx),window.Sylx.Text=function(o,e,t){"use strict";var c={},f=null;return{registerFont:function(e,t,n){var i=n?Object.assign({},n):{};if(!i.firstCharCode)throw"Missing property: firstCharCode";if(!i.characterWidth)throw"Missing property: characterWidth";if("string"==typeof t)i.bitmap=new o.Image,i.bitmap.src=t;else{if("object"!=typeof t)throw"Unknown bitmap format provided.";t.data&&(i.bitmap=t.data)}n.setAsDefault&&(f=e),c[e]=i},renderText:function(e,t,n,i,o){o=o||{};var r="string"==typeof e?e:e.toString();o.noTrim||(r=r.trim());for(var a=o.font?c[o.font]:c[f],s=0;s<r.length;s++){var l=r.charCodeAt(s);l>=a.firstCharCode&&l<=a.lastCharCode&&i.drawImage(a.bitmap,(l-a.firstCharCode)*a.characterWidth,0,a.characterWidth,a.characterHeight,t+s*a.characterWidth,n,a.characterWidth,a.characterHeight)}},createPrerenderImage:function(){}}}(window,window.Sylx);